steps:
  - name: 'gcr.io/cloud-builders/mvn'
    # parallel builds (-T2) hang for some reason
    args: [
            'package', '-B', '-DskipTests'
          ]
  - name: 'gcr.io/cloud-builders/docker'
    args: [
            'build',
            '--build-arg', 'SERVICE_NAME=${_SERVICE_NAME}',
            '-t', 'gcr.io/$PROJECT_ID/osdu-gcp-${_SERVICE_NAME}:${_SHORT_SHA}',
            '-t', 'gcr.io/$PROJECT_ID/osdu-gcp-${_SERVICE_NAME}:latest',
            '-f', 'Dockerfile.cloudbuild',
            '.' ]
images:
  - 'gcr.io/$PROJECT_ID/osdu-gcp-${_SERVICE_NAME}'
